<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>VPNs en Ubuntu | El Blog de Marcelo!</title>
<meta name="keywords" content="">
<meta name="description" content="Buenas&hellip; esta es una gu칤a de instalaci칩n y configuraci칩n de un v칤nculo punto a punto autenticado y encriptado por medio de una red insegura (como puede ser Internet), denominado m치s com칰nmente VPN. Para su implementaci칩n se utilizar치 OpenVPN sobre el Sistema Operativo Ubuntu 8.04, aunque seguramente estos mismos pasos servir치n para Debian u otros derivados de ella (tal como lo es Ubuntu).
 Instalaci칩n
La instalaci칩n, como sucede con la mayor칤a del software ya disponible en los repositorios de Ubuntu, es sencilla: una vez en la consola, tipear:">
<meta name="author" content="mfernandez">
<link rel="canonical" href="http://localhost:1313/2008/07/vpns-en-ubuntu/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6330bae568fb8548cd5ae396c8d8ff700d4fc0f161c35971ab47e9c5bf9a2e17.css" integrity="sha256-YzC65Wj7hUjNWuOWyNj/cA1PwPFhw1lxq0fpxb&#43;aLhc=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/2008/07/vpns-en-ubuntu/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">

</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="El Blog de Marcelo! (Alt + H)">El Blog de Marcelo!</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="">
                    <span></span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/" title="Inicio">
                    <span>Inicio</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/charlas/" title="Charlas">
                    <span>Charlas</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/proyectos/" title="Proyectos">
                    <span>Proyectos</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/publicaciones/" title="Publicaciones">
                    <span>Publicaciones</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/sobre-mi/" title="Sobre M칤">
                    <span>Sobre M칤</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about-me/" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="游댌">
                    <span>游댌</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;췉&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      VPNs en Ubuntu
    </h1>
    <div class="post-meta"><span title='2008-07-15 23:16:00 +0000 +0000'>July 15, 2008</span>&nbsp;췅&nbsp;9 min&nbsp;췅&nbsp;mfernandez

</div>
  </header> 
  <div class="post-content"><p>Buenas&hellip; esta es una gu칤a de instalaci칩n y configuraci칩n de un v칤nculo punto a punto autenticado y encriptado por medio de una red insegura (como puede ser Internet), denominado m치s com칰nmente <a href="http://es.wikipedia.org/wiki/Red_privada_virtual">VPN</a>. Para su implementaci칩n se utilizar치 <a href="http://openvpn.net/">OpenVPN</a> sobre el Sistema Operativo <a href="http://www.ubuntu.com/">Ubuntu 8.04</a>, aunque seguramente estos mismos pasos servir치n para <a href="http://www.debian.org/">Debian</a> u otros derivados de ella (tal como lo es Ubuntu).</p>
<p><a href="http://openvpn.net/"><img loading="lazy" src="http://3.bp.blogspot.com/_nDZ247g0qSM/SH3YX_Eo8HI/AAAAAAAABFo/nFrxsPPEUPg/s400/openvpn_logo.png"></a> Instalaci칩n
La instalaci칩n, como sucede con la mayor칤a del software ya disponible en los repositorios de Ubuntu, es sencilla: una vez en la consola, tipear:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">mfernandez</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">saturno</span>:~<span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">openvpn</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reading</span> <span style="color:#f92672">package</span> <span style="color:#a6e22e">lists</span><span style="color:#f92672">...</span> <span style="color:#a6e22e">Done</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Building</span> <span style="color:#a6e22e">dependency</span> <span style="color:#a6e22e">tree</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Reading</span> <span style="color:#a6e22e">state</span> <span style="color:#a6e22e">information</span><span style="color:#f92672">...</span> <span style="color:#a6e22e">Done</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">following</span> <span style="color:#a6e22e">extra</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">installed</span>:
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Suggested</span> <span style="color:#a6e22e">packages</span>:
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">resolvconf</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">following</span> <span style="color:#a6e22e">NEW</span> <span style="color:#a6e22e">packages</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">installed</span>:
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">openvpn</span> <span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> <span style="color:#a6e22e">upgraded</span>, <span style="color:#ae81ff">2</span> <span style="color:#a6e22e">newly</span> <span style="color:#a6e22e">installed</span>, <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">remove</span> <span style="color:#a6e22e">and</span> <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">upgraded</span>.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Need</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">get</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">B</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1439</span><span style="color:#a6e22e">kB</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">archives</span>.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">After</span> <span style="color:#a6e22e">this</span> <span style="color:#a6e22e">operation</span>, <span style="color:#ae81ff">3228</span><span style="color:#a6e22e">kB</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">additional</span> <span style="color:#a6e22e">disk</span> <span style="color:#a6e22e">space</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">used</span>.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Do</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">want</span> <span style="color:#a6e22e">to</span> <span style="color:#66d9ef">continue</span> [<span style="color:#a6e22e">Y</span><span style="color:#f92672">/</span><span style="color:#a6e22e">n</span>]<span style="color:#960050;background-color:#1e0010">?</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Preconfiguring</span> <span style="color:#a6e22e">packages</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Selecting</span> <span style="color:#a6e22e">previously</span> <span style="color:#a6e22e">deselected</span> <span style="color:#f92672">package</span> <span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist</span>.
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">Reading</span> <span style="color:#a6e22e">database</span> <span style="color:#f92672">...</span> <span style="color:#ae81ff">25764</span> <span style="color:#a6e22e">files</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">directories</span> <span style="color:#a6e22e">currently</span> <span style="color:#a6e22e">installed</span>.)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Unpacking</span> <span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist</span> (<span style="color:#a6e22e">from</span> <span style="color:#f92672">.../</span><span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist_0</span><span style="color:#ae81ff">.1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0</span><span style="color:#a6e22e">ubuntu0</span><span style="color:#ae81ff">.8.04.1</span><span style="color:#a6e22e">_all</span>.<span style="color:#a6e22e">deb</span>) <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Selecting</span> <span style="color:#a6e22e">previously</span> <span style="color:#a6e22e">deselected</span> <span style="color:#f92672">package</span> <span style="color:#a6e22e">openvpn</span>.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Unpacking</span> <span style="color:#a6e22e">openvpn</span> (<span style="color:#a6e22e">from</span> <span style="color:#f92672">.../</span><span style="color:#a6e22e">openvpn_2</span><span style="color:#ae81ff">.1</span>~<span style="color:#a6e22e">rc7</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#a6e22e">ubuntu3</span><span style="color:#ae81ff">.3</span><span style="color:#a6e22e">_i386</span>.<span style="color:#a6e22e">deb</span>) <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Setting</span> <span style="color:#a6e22e">up</span> <span style="color:#a6e22e">openvpn</span><span style="color:#f92672">-</span><span style="color:#a6e22e">blacklist</span> (<span style="color:#ae81ff">0.1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0</span><span style="color:#a6e22e">ubuntu0</span><span style="color:#ae81ff">.8.04.1</span>) <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Setting</span> <span style="color:#a6e22e">up</span> <span style="color:#a6e22e">openvpn</span> (<span style="color:#ae81ff">2.1</span>~<span style="color:#a6e22e">rc7</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#a6e22e">ubuntu3</span><span style="color:#ae81ff">.3</span>) <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> <span style="color:#a6e22e">Restarting</span> <span style="color:#a6e22e">virtual</span> <span style="color:#a6e22e">private</span> <span style="color:#a6e22e">network</span> <span style="color:#a6e22e">daemon</span>.                                      [ <span style="color:#a6e22e">OK</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mfernandez</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">saturno</span>:~<span style="color:#960050;background-color:#1e0010">$</span>
</span></span></code></pre></div><p>A partir de este momento, OpenVPN est치 instalado en esta m치quina, y luego habr치 que instalarlo de la misma manera en el otro nodo que funcionar치 como extremo opuesto. De ahora en m치s, vamos a llamarle nodo &ldquo;A&rdquo; al que funcionar치 como &ldquo;Servidor&rdquo; de VPN y nodo &ldquo;B&rdquo; al que ser치 el &ldquo;Cliente&rdquo;.</p>
<p>Configuraci칩n Gen칠rica de OpenVPN
El paquete OpenVPN en Ubuntu est치 bien integrado a la estructura de directorios est치ndar de este SO:</p>
<ul>
<li>En el directorio /etc/openvpn/ se guardan los archivos de configuraci칩n de las diferentes conexiones que se pueden crear. El archivo /etc/openvpn/conexion.conf, por ejemplo, va a contener las instrucciones para establecer un v칤nculo VPN.</li>
<li>En el archivo /etc/default/openvpn se configuran los enlaces alojados en /etc/openvpn/ que va a administrar el script de arranque/parada de OpenVPN (ver punto siguiente), y si se va a generar un archivo de &ldquo;status&rdquo; o no.</li>
<li>El archivo /etc/init.d/openvpn sirve para poder arrancar, parar y reiniciar las VPNs configuradas en el archivo /etc/default/openvpn.</li>
</ul>
<p>La 칰nica diferencia entre el nodo A y B residir치 en el archivo de configuraci칩n, que por ejemplo puede ser /etc/openvpn/conexion-a-A.conf en el Cliente y /etc/openvpn/conexion-desde-B.conf en el Servidor. El resto es igual en ambos hosts.</p>
<p>Archivo Default
Tal como se dijo anteriormente, en /etc/default/openvpn se indican los archivos de configuraci칩n (que se traducen en conexiones) que administrar치 el script /etc/init.d/openvpn. El contenido de este archivo es el siguiente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># This is the configuration file for /etc/init.d/openvpn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Start only these VPNs automatically via init script.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Allowed values are &#34;all&#34;, &#34;none&#34; or space separated list of</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># names of the VPNs. If empty, &#34;all&#34; is assumed.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#AUTOSTART=&#34;all&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#AUTOSTART=&#34;none&#34;</span>
</span></span><span style="display:flex;"><span>AUTOSTART<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;conexion-a-A&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Refresh interval (in seconds) of default status files</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># located in /var/run/openvpn.$NAME.status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Defaults to 10, 0 disables status file generation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>STATUSREFRESH<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#STATUSREFRESH=0</span>
</span></span></code></pre></div><p>Los 칰nicos dos par치metros que existen son AUTOSTART y STATUSREFRESH. El primero puede ser igual a &ldquo;all&rdquo;, &ldquo;none&rdquo; o un listado de archivos que deber치n existir en /etc/openvpn, pero sin la extensi칩n .conf [1].</p>
<p>Archivo de Configuraci칩n Cliente - B
El archivo de conexi칩n de un cliente /etc/openvpn/conexion-a-A.conf ser치 muy similar al siguiente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># Sample OpenVPN configuration file for
</span></span><span style="display:flex;"><span># home using a pre-shared static key.
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># &#39;#&#39; or &#39;;&#39; may be used to delimit comments.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Use a dynamic tun device.
</span></span><span style="display:flex;"><span># For Linux 2.2 or non-Linux OSes,
</span></span><span style="display:flex;"><span># you may want to use an explicit
</span></span><span style="display:flex;"><span># unit number such as &#34;tun1&#34;.
</span></span><span style="display:flex;"><span># OpenVPN also supports virtual
</span></span><span style="display:flex;"><span># ethernet &#34;tap&#34; devices.
</span></span><span style="display:flex;"><span>dev tun
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Our OpenVPN peer is the office gateway.
</span></span><span style="display:flex;"><span>remote 74.125.47.103
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 10.1.0.2 is our local VPN endpoint (home).
</span></span><span style="display:flex;"><span># 10.1.0.1 is our remote VPN endpoint (office).
</span></span><span style="display:flex;"><span>ifconfig 10.1.0.2 10.1.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Our up script will establish routes
</span></span><span style="display:flex;"><span># once the VPN is alive.
</span></span><span style="display:flex;"><span>up ./conexion-a-A.up
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Our pre-shared static key
</span></span><span style="display:flex;"><span>secret test.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># OpenVPN 2.0 uses UDP port 1194 by default
</span></span><span style="display:flex;"><span># (official port assignment by iana.org 11/04).
</span></span><span style="display:flex;"><span># OpenVPN 1.x uses UDP port 5000 by default.
</span></span><span style="display:flex;"><span># Each OpenVPN tunnel must use
</span></span><span style="display:flex;"><span># a different port number.
</span></span><span style="display:flex;"><span># lport or rport can be used
</span></span><span style="display:flex;"><span># to denote different ports
</span></span><span style="display:flex;"><span># for local and remote.
</span></span><span style="display:flex;"><span>port 1194
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Downgrade UID and GID to
</span></span><span style="display:flex;"><span># &#34;nobody&#34; after initialization
</span></span><span style="display:flex;"><span># for extra security.
</span></span><span style="display:flex;"><span>; user nobody
</span></span><span style="display:flex;"><span>; group nobody
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># If you built OpenVPN with
</span></span><span style="display:flex;"><span># LZO compression, uncomment
</span></span><span style="display:flex;"><span># out the following line.
</span></span><span style="display:flex;"><span>; comp-lzo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Send a UDP ping to remote once
</span></span><span style="display:flex;"><span># every 15 seconds to keep
</span></span><span style="display:flex;"><span># stateful firewall connection
</span></span><span style="display:flex;"><span># alive.  Uncomment this
</span></span><span style="display:flex;"><span># out if you are using a stateful
</span></span><span style="display:flex;"><span># firewall.
</span></span><span style="display:flex;"><span>ping 10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Uncomment this section for a more reliable detection when a system
</span></span><span style="display:flex;"><span># loses its connection.  For example, dial-ups or laptops that
</span></span><span style="display:flex;"><span># travel to other locations.
</span></span><span style="display:flex;"><span>; ping 15
</span></span><span style="display:flex;"><span>; ping-restart 45
</span></span><span style="display:flex;"><span>; ping-timer-rem
</span></span><span style="display:flex;"><span>; persist-tun
</span></span><span style="display:flex;"><span>; persist-key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Verbosity level.
</span></span><span style="display:flex;"><span># 0 -- quiet except for fatal errors.
</span></span><span style="display:flex;"><span># 1 -- mostly quiet, but display non-fatal network errors.
</span></span><span style="display:flex;"><span># 3 -- medium output, good for normal operation.
</span></span><span style="display:flex;"><span># 9 -- verbose, good for troubleshooting
</span></span><span style="display:flex;"><span>verb 3
</span></span></code></pre></div><p>Es importante prestar atenci칩n y adaptar convenientemente los siguientes par치metros:</p>
<ul>
<li>remote y port. B치sicamente indica la IP y el puerto del host (respectivamente) correspondientes a la red insegura contra el cual queremos establecer la VPN. El puerto 1194 es el default de OpenVPN.</li>
<li>ifconfig. Indica la IP virtual de ambos extremos de la VPN.</li>
<li>up. Es el script bash que se ejecuta apenas se levanta la interfaz. Notar que el &ldquo;./&rdquo; indica que el script debe estar en el mismo directorio del archivo de configuraci칩n, esto es, /etc/openvpn/conexion-a-A.up. Usualmente sirve para establecer la nueva ruta (con el comando route) de la interfaz, aunque puede servir para cualquier cosa.</li>
<li>secret. Es el archivo con la clave pre-compartida (pre-shared) que ambos nodos deben poseer para que la conexi칩n se inicie. Obviamente deben coincidir en ambos extremos, y se recomienda que una vez generado en uno, se transfiera a otro por un canal seguro, como SSH, por ejemplo. Este archivo tambi칠n debe residir en el mismo directorio del archivo .conf.</li>
<li>ping. Dado que OpenVPN trabaja sobre un protocolo no orientado a la conexi칩n como lo es UDP, es probable de que si hay firewalls entre ambos extremos de la conexi칩n, la conexi칩n sea filtrada por el mismo al no haber tr치fico. El par치metro ping evita esto, haciendo que se env칤e tr치fico para que la conexi칩n nunca se caiga.</li>
</ul>
<p>Creaci칩n de la Clave Pre-Compartida
Como se dijo anteriormente, la clave pre-compartida es un archivo que deber치 residir en el directorio /etc/openvpn de ambos nodos, y ser referenciada por el archivo de configuraci칩n de cada uno, por medio de su par치metro secret. La clave se genera con el siguiente comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>root@saturno:/etc/openvpn#  openvpn --genkey --secret test.key
</span></span><span style="display:flex;"><span>root@saturno:/etc/openvpn# cat test.key
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># 2048 bit OpenVPN static key
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span>-----BEGIN OpenVPN Static key V1-----
</span></span><span style="display:flex;"><span>7e603bfe70074e19efc3dfd4440c145f
</span></span><span style="display:flex;"><span>be2bbcc7812ce409780819b78e60bf66
</span></span><span style="display:flex;"><span>8df944d7d40c119c4d9075a750e2d5e8
</span></span><span style="display:flex;"><span>8289d67628faa69b0c4cb531727e4c64
</span></span><span style="display:flex;"><span>145d0c4365ff0216963b3d67084225f2
</span></span><span style="display:flex;"><span>e764facf91f248385152c8ccfcf93e40
</span></span><span style="display:flex;"><span>ffb8aa19173bf4c12da08337f30d7f1f
</span></span><span style="display:flex;"><span>61ea30ef51518276cc8fac51ac0793cd
</span></span><span style="display:flex;"><span>8ba9417a68ca07ca400a72579aa82036
</span></span><span style="display:flex;"><span>c15ccb5e470b4571ac58ef03c3d3144f
</span></span><span style="display:flex;"><span>c8d586a30901fb7401d7d982d8805325
</span></span><span style="display:flex;"><span>48c39f9a10ecba889ee3eeed3893fb98
</span></span><span style="display:flex;"><span>2220804f860d100f9d7f602ee50c20ee
</span></span><span style="display:flex;"><span>986e077958b111fbb57a0cdafa6a4ecd
</span></span><span style="display:flex;"><span>0b59483d02b5185cf6abb9a83af948fe
</span></span><span style="display:flex;"><span>61393ca6b50137257b255a296ff844e2
</span></span><span style="display:flex;"><span>-----END OpenVPN Static key V1-----
</span></span><span style="display:flex;"><span>root@saturno:/etc/openvpn#
</span></span></code></pre></div><p>Para pasar este archivo al equipo que funcionar치 como extremo opuesto de la VPN, se sugiere (nuevamente) un medio de transporte confiable, como pen drives, CDs, o en su defecto, SSH. El comando scp test.key <a href="mailto:marcelo@74.125.47.103">marcelo@74.125.47.103</a>:~/ copiar치 por medio de SSH el archivo test.key al equipo en 74.125.47.103, y para hacerlo, se loguear치 con el usuario &ldquo;marcelo&rdquo;, dejando el archivo en su home.</p>
<p>Script de inicio
El script bash de inicio que se muestra a continuaci칩n agrega como ruta a cualquier host del rango 10.1.0.0-254</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@saturno:/etc/openvpn# cat conexion-a-A.up
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/sh</span>
</span></span><span style="display:flex;"><span>route add -net 10.1.0.0 netmask 255.255.255.0 gw $5
</span></span></code></pre></div><p>Archivo de Configuraci칩n Servidor - A
Como se dijo anteriormente, lo 칰nico que var칤a en definitiva en el Servidor VPN (&ldquo;A&rdquo; en este caso) es el archivo de configuraci칩n. As칤 y todo, las diferencias son sutiles (es decir, muy pocas). El archivo de configuraci칩n /etc/openvpn/conexion-desde-B.conf s칩lo difiere del que est치 en el cliente en los siguientes par치metros:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[...]
</span></span><span style="display:flex;"><span># *** El par치metro remote s칩lo se usa en el cliente!!!! ***
</span></span><span style="display:flex;"><span># remote 190.210.30.194
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 10.1.0.1 is our local VPN endpoint (office).
</span></span><span style="display:flex;"><span># 10.1.0.2 is our remote VPN endpoint (home).
</span></span><span style="display:flex;"><span>ifconfig 10.1.0.1 10.1.0.2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Our up script will establish routes
</span></span><span style="display:flex;"><span># once the VPN is alive.
</span></span><span style="display:flex;"><span>up ./conexion-desde-B.up
</span></span><span style="display:flex;"><span>[...]
</span></span></code></pre></div><p>En resumen, las diferencias son:</p>
<ul>
<li>remote no se usa en el servidor (s칩lo se usa en el cliente).</li>
<li>El orden de las IPs virtuales a utilizar con el par치metro ifconfig se invierte, como es l칩gico.</li>
<li>El script a ejecutar cambia.</li>
</ul>
<p>Con respecto al script que configura las rutas, es bueno saber que sin que haga falta ejecutar script alguno, la ruta 10.1.0.2 -dev tun0 se levanta autom치ticamente en el servidor (y lo mismo sucede con la 10.1.0.1 en el cliente). La configuraci칩n de la ruta para la red 10.x.x.x en el cliente permite mapear el resto de IPs 10.x.x.x que pueden existir detr치s del Servidor VPN, con el objetivo de que el cliente las vea y pueda comunicarse por estos hosts por medio del Servidor VPN. En resumen, si s칩lo se pretende comunicar dos extremos (y no hay ninguna red detr치s de ninguno de los dos equipos), el route add -net&hellip; no hace falta.Ejecuci칩n
En resumen, para levantar la VPN, s칩lo hay que ejecutar tanto en el servidor como en el cliente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>mfernandez@B:~$ sudo /etc/init.d/openvpn start
</span></span><span style="display:flex;"><span>* Starting virtual private network daemon.
</span></span><span style="display:flex;"><span>* conexion-a-A (OK)                                                            [ OK ]
</span></span><span style="display:flex;"><span>mfernandez@B:~$
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mfernandez@A:~$ sudo /etc/init.d/openvpn start
</span></span><span style="display:flex;"><span>* Starting virtual private network daemon.
</span></span><span style="display:flex;"><span>* conexion-desde-B (OK)                                                        [ OK ]
</span></span><span style="display:flex;"><span>mfernandez@stimpy:~$
</span></span></code></pre></div><p>Conclusi칩n
Si bien no es algo muy sencillo de comprender para alguien ajeno a las redes, para el profesional inform치tico en cambio las VPNs representan una herramienta important칤sima para resolver problemas de conectividad como la indisposici칩n de IPs p칰blicas, manteniendo una seguridad y flexibilidad dif칤ciles de igualar. Si combinamos eso con un software multiplataforma, libre y de configuraci칩n extremadamente sencilla como OpenVPN, tenemos un ganador. :-)</p>
<p>[1] En realidad, si al levantar OpenVPN no existe alg칰n archivo .conf, no importa, el script de inicio muestra un warning avisando que no existe y sigue adelante con el resto de las conexiones definidas en el archivo.</p>
<p>Quejas, dudas, comentarios e insultos? Comenten este post o manden un bonito correo, gracias! :-D</p>
<p>Saludos
Marcelo</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on x"
            href="https://x.com/intent/tweet/?text=VPNs%20en%20Ubuntu&amp;url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f&amp;title=VPNs%20en%20Ubuntu&amp;summary=VPNs%20en%20Ubuntu&amp;source=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f&title=VPNs%20en%20Ubuntu">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on whatsapp"
            href="https://api.whatsapp.com/send?text=VPNs%20en%20Ubuntu%20-%20http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on telegram"
            href="https://telegram.me/share/url?text=VPNs%20en%20Ubuntu&amp;url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share VPNs en Ubuntu on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=VPNs%20en%20Ubuntu&u=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fvpns-en-ubuntu%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
